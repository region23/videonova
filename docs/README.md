# Документация VideoNova

## Содержание

- [Обзор архитектуры](#обзор-архитектуры)
- [Структура проекта](#структура-проекта)
- [Модули и компоненты](#модули-и-компоненты)
- [API внешних сервисов](#api-внешних-сервисов)
- [Процесс обработки видео](#процесс-обработки-видео)
- [Руководство по расширению функциональности](#руководство-по-расширению-функциональности)

## Обзор архитектуры

VideoNova построена на базе фреймворка Tauri, который объединяет frontend на Vue.js и backend на Rust. Такая архитектура обеспечивает высокую производительность, безопасность и кроссплатформенность приложения.

### Frontend (Vue.js + TypeScript)

Frontend отвечает за интерфейс пользователя и взаимодействие с пользователем. Он построен с использованием Vue 3 и TypeScript, что обеспечивает типобезопасность и хорошую структуру кода.

### Backend (Rust)

Backend реализован на Rust и управляет всеми сложными операциями, такими как:
- Управление файловой системой
- Запуск внешних утилит (yt-dlp, ffmpeg)
- Работа с API (OpenAI)
- Обработка аудио и видео
- Синхронизация субтитров и речи

## Структура проекта

```
videonova/
├── src/                   # Frontend (Vue.js + TypeScript)
│   ├── components/        # Vue компоненты
│   ├── assets/            # Статические ресурсы (CSS, изображения)
│   ├── stores/            # Хранилище состояния приложения
│   ├── App.vue            # Корневой компонент
│   └── main.ts            # Точка входа
├── src-tauri/             # Backend (Rust)
│   ├── src/               # Исходный код Rust
│   │   ├── main.rs        # Точка входа backend
│   │   ├── commands.rs    # Команды Tauri
│   │   ├── tts-sync/      # Модуль для TTS и синхронизации
│   │   ├── subtitle/      # Парсинг и обработка субтитров
│   │   └── utils/         # Вспомогательные функции
│   ├── Cargo.toml         # Зависимости Rust
│   └── tauri.conf.json    # Конфигурация Tauri
├── .github/               # GitHub Actions конфигурация
│   └── workflows/         # CI/CD workflows
├── docs/                  # Документация проекта
├── public/                # Публичные статические ресурсы
├── package.json           # Зависимости Node.js
└── README.md              # Основная документация
```

## Модули и компоненты

### Модуль TTS-Sync

Модуль для генерации и синхронизации речи с видео. Включает:
- `openai.rs` - Интеграция с OpenAI API для TTS
- Синхронизацию аудио с субтитрами
- Постобработку аудио

```rust
pub struct TtsSegment {
    /// Оригинальный субтитр
    pub original_subtitle: Subtitle,
    /// Текст для TTS
    pub text: String,
    /// Путь к аудиофайлу
    pub audio_file: Option<String>,
    /// Путь к обработанному аудиофайлу
    pub processed_audio_file: Option<String>,
    /// Параметры постобработки
    pub post_processing: Option<PostProcessingParams>,
}
```

### Модуль обработки субтитров

Модуль для работы с субтитрами включает:
- Парсинг различных форматов субтитров (SRT, VTT)
- Управление временными метками
- Объединение и разделение субтитров

### Внешние утилиты

- **yt-dlp**: Загрузка видео и извлечение аудио
- **ffmpeg**: Обработка видео, аудио и интеграция субтитров
- **Whisper**: Распознавание речи

## API внешних сервисов

### OpenAI API

VideoNova использует OpenAI API для:
1. Перевода текста субтитров
2. Генерации речи (TTS)

```rust
async fn generate_speech_for_segments(
    segments: &[TtsSegment],
    config: &TtsSyncConfig,
    tracker: Option<&ProgressTracker>,
) -> Result<String>
```

## Процесс обработки видео

1. **Загрузка видео**
   - Использование yt-dlp для скачивания видео с интернет-платформ
   - Или использование локального видеофайла

2. **Извлечение аудио**
   - Отделение аудиодорожки для обработки

3. **Распознавание речи**
   - Использование Whisper для преобразования аудио в текст
   - Создание исходных субтитров с временными метками

4. **Перевод субтитров**
   - Разделение текста на логические фрагменты
   - Отправка в API для перевода
   - Сохранение временных меток

5. **Генерация речи**
   - Преобразование переведенного текста в речь
   - Оптимизация скорости и интонации

6. **Синхронизация**
   - Подгонка аудиодорожки под временные метки видео

7. **Финальная сборка**
   - Объединение исходного видео, переведенной аудиодорожки и субтитров
   - Сохранение результата

## Руководство по расширению функциональности

### Добавление нового TTS-провайдера

1. Создайте новый файл в директории `src-tauri/src/tts-sync/src/tts/`
2. Реализуйте интерфейс, соответствующий другим TTS-провайдерам
3. Добавьте нового провайдера в конфигурацию
4. Обновите UI для выбора нового провайдера

### Поддержка нового формата субтитров

1. Добавьте парсер в модуль работы с субтитрами
2. Реализуйте функции чтения и записи в новом формате
3. Обновите обработчики для поддержки нового формата

### Оптимизация производительности

- Используйте параллелизм для обработки сегментов
- Реализуйте кэширование для повторяющихся операций
- Оптимизируйте взаимодействие с внешними API 